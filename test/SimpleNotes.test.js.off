const { expect } = require("chai");
const { ethers } = require("hardhat");

describe("SimpleNotes", function() {
    let note;
    let user1;

    beforeEach(async function() {
    [user1] = await ethers.getSigners();
    const SimpleNotes = await ethers.getContractFactory("SimpleNotes");
    note = await SimpleNotes.deploy();
    await note.waitForDeployment();
});

it("Should save note correctly", async function() {
    await note.connect(user1).saveNote("Hello");
    const newNote = await note.notes(user1.address);
    expect(newNote).to.equal("Hello");
});


it("should revert if user tries to save second note", async function() {
    await note.connect(user1).saveNote("First note");
    await expect(note.connect(user1).saveNote("Second note")).to.be.revertedWithCustomError(note, "NoteAlreadyExist");
});

it("should return note using getNote()", async function () {
    await note.connect(user1).saveNote("Test note");
    const userNote = await note.connect(user1).getNote();
    expect(userNote).to.equal("Test note");
});
it("should emit NoteSaved event with correct timestamp", async function () {
    const tx = await note.connect(user1).saveNote("Hello");
    const block = await tx.getBlock();
    await expect(tx).to.emit(note, "NoteSaved")
    .withArgs(user1.address, "Hello", block.timestamp);

});

})





it("should store different notes for different users", async function () {
  const [user1, user2] = await ethers.getSigners();

  await note.connect(user1).saveNote("Note1");
  await note.connect(user2).saveNote("Note2");

  const note1 = await note.connect(user1).getNote();
  const note2 = await note.connect(user2).getNote();

  expect(note1).to.equal("Note1");
  expect(note2).to.equal("Note2");
});


